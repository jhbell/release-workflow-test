name: Release

on:
  release:
    types: [published]

jobs:
  publish:
    runs-on: ubuntu-latest
    env:
      IS_PRERELEASE: ${{ github.event.release.prerelease }}
      TAG_NAME: ${{ github.event.release.tag_name
    steps:
      - uses: actions/checkout@v2
      
      - name: Print if this is a prerelease
        if: env.IS_PRERELEASE == 'true'
        run: echo "This is a prerelease! $IS_PRERELEASE"

      - name: Print if this is NOT a prerelease
        if: env.IS_PRERELEASE == 'false'
        run: echo "Not a prerelease. $IS_PRERELEASE"

      - id: get-tag
        name: Retrieve the package name and target version
        run: |
          package=${{ github.event.tag_name }} | cut -d/ -f 1
          echo "Found desired package name $package"
          echo "::set-output name=package::$package"
          version=${{ github.event.tag_name }} | cut -d/ -f 2
          echo "Found desired version $version"
          echo "::set-output name=version::$version"
          
      - name: Print the package and version  
        run: |
          echo "Package name is ${{ steps.get-tag.outputs.package }} and version to publish is ${{ steps.get-tag.outputs.version }}"
